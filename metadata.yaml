name: intelligent_retry
desc: 当LLM回复为空或包含特定错误关键词/可配置状态码时，自动重试并保持原有上下文与人设；支持指数退避、状态码白/黑名单与失败兜底。
version: 2.6.3
author: 木有知 & 长安某
repo: https://github.com/muyouzhi6/astrbot_plugin_retry
config:
  - key: enable_truncation_retry
    name: 启用截断重试
    desc: 开启后，检测到回复结尾不是常见标点/字母/数字/文件后缀/网址时自动重试（如 Gemini 截断），建议仅在遇到相关问题时开启。
    type: bool
    default: false
  - key: truncation_valid_tail_pattern
    name: 截断判定合法结尾正则
    desc: 用于判定回复结尾是否完整，支持自定义正则，默认已覆盖常见标点、字母、数字、文件后缀、网址等。
    type: string
    default: "[。！？!?,.\\w\\d\\u4e00-\\u9fa5]$|\\.(com|cn|org|net|io|ai|pdf|jpg|png|jpeg|gif|mp3|mp4|txt|zip|tar|gz|html|htm)$|https?://[\\w\\.-]+$"
  - key: retry_delay_mode
    name: 重试间隔模式
    desc: 选择重试间隔的模式。fixed=每次重试间隔固定，exponential=指数退避（每次翻倍，最大30秒）。
    type: string
    default: exponential
    options:
      - fixed
      - exponential
